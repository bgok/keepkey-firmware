## Universal Second Factor (U2F) feature

U2F is an open protocol standardized by the [FIDO Alliance](https://www.fidoalliance.org) that let you use a cryptographic challenge as a Second Factor mechanism, providing a more secure authentication than OTP codes or SMS.

The optional U2F feature lets you use your KeepKey device as a U2F token on any compatible website. At the present time, U2F support has been enabled for [Google accounts](https://support.google.com/accounts/answer/6103523), [Github](https://github.com/blog/2071-github-supports-universal-2nd-factor-authentication) and [Dropbox](https://blogs.dropbox.com/dropbox/2015/08/u2f-security-keys/) for Chrome and Chromium browsers. Multiple Open Source implementations are also available.

### Using with a PIN or passphrase set 

Make sure that you unlock your KeepKey through a third party application before using it with a U2F client - otherwise U2F functionalities will be disabled.

### Building with U2F support 

Add -u to your ./b call

### Attestation Certificate creation 

Before initializing U2F, you need to create an attestation certificate that'll authenticate the keys generated by your device. It is possible to share this certificate across multiple devices for optimal privacy.

You can follow those steps to create a self signed certificate with OpenSSL

```
openssl ecparam -out attestation_private_key.pem -name prime256v1 -genkey
openssl req -new -key attestation_private_key.pem -out attestation_cert.csr
openssl x509 -req -days 3650 -in attestation_cert.csr -signkey attestation_private_key.pem -out attestation_cert.der -outform der
```

You'll then need to get a hexadecimal dump of the certificate

```
xxd -p attestation_cert.der | tr -d '\n'
```

As well as an hexadecimal dump of the private key

```
cat attestation_private_key.pem | tail -n +4 | openssl asn1parse
```

### Device initialization 

You need to pass the attestation certificate, its associated private key and the current value of the U2F counter after initializing your KeepKey device - reinitializing the counter is only necessary if restoring a previous version of the device which has already been registered, and you'll need to use a higher value.

```
cmdkk.py u2f_init -k private_key_hexadecimal -t attestation_certificate_hexadecimal -c 1
```

If at some point later you need to reinitialize your device, or restore on a different device, you can query the current value of the counter with 

```
cmdkk.py u2f_get_counter
```

### Displaying additional information for a specific implementation

KeepKey can display additional information associated to an Application ID hash - you can provision one dynamically before the standard U2F client is invoked if you know its Application ID.

```
cmdkk.py u2f_add_transient_entry -u URI_used_as_application_ID -n name_to_display
```

### Additional U2F resources 

Specifications : 

  * https://fidoalliance.org/specifications/download/

Test servers : 

   * https://u2fdemo.appspot.com
   * https://demo.yubico.com/u2f
   * https://u2f.cloudentify.com
   * https://u2f.plug-up.net

Open Source code : 

   * https://www.yubico.com/applications/fido/
   * https://github.com/google/u2f-ref-code
   * http://www.gluu.org/

### Acknowledgements 

This implementation has been developed and is maintained by Ledger (hello@ledger.fr)
